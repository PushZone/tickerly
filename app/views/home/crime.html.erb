<section class="admin-crime">
  <div class="btn btn-success">
    All Crime  <%= Crime.count %>
  </div>
  <div class="btn btn-primary">
    Today Crime  <%= @today_crimes.count %>
  </div>

  <div class="map">
    <div id="map"></div>
  </div>
  <div>
  <div class="new-crime-box">
    <h5>Crime Location</h5>
    <div class="row">
      <input placeholder="latitude" id="mLat" ng-model="newCrime.lat">
    </div>
    <div class="row">
      <input placeholder="longitude" id="mLgn" ng-model="newCrime.lon">
    </div>
    <div class="row">
      <textarea placeholder="Location name" id="locationName"></textarea>
    </div>
    <div class="row">
      <input placeholder="Desc" id="desc">
    </div>
    <div class="row">
      <div class="form-group">
        <label for="crimeType">Crime Type</label>
        <select class="form-control" id="crimeType" ng-model="newCrime.type">
          <option>Abuse</option>
          <option>Assualt</option>
          <option>Burglary</option>
          <option>Car accidents</option>
          <option>Disturbance</option>
          <option>Drug</option>
          <option>Explosure</option>
          <option>Fire</option>
          <option>Gun</option>
          <option>Harassment</option>
          <option>Kidnap</option>
          <option>Loitering</option>
          <option>Lost pet</option>
          <option>Riot</option>
          <option>Robbery</option>
          <option>Theft</option>
          <option>Other</option>
        </select>
      </div>
    </div>
    
    <div class="row">
      <div class="btn btn-success">Add new Crime</div>
    </div>
  </div>

  <div class="add-store-box">
    <div ng-hide="selectedStore">
    <h5>Crime lists</h5>
      <div class="store-list-box">
        <ul>
          <li ng-repeat="store in crimeLists" class="store-detail-box">
            <span ng-click="selectStore(store)">{{store.name}} ({{store.type}})</span>
            <div class="btn btn-danger pull-right" ng-click="removeStore(store.id)">Delete</div>
          </li>
        </ul>

      </div>
    </div>
    <div class="addnew-box" ng-show="selectedStore">
      <h5>Add Store item</h5>
      <div class="row">
        <input placeholder="Name" ng-model="storeItem.name">
      </div>
      <div class="row">
        <input placeholder="Desc" ng-model="storeItem.description">
      </div>
      <div class="row">
        <input placeholder="point" ng-model="storeItem.point">
      </div>
      <div class="row">
        <input placeholder="discount" id="discount" ng-model="storeItem.discount">
      </div>
      
      
      <div class="row">
        <div class="btn btn-success" ng-click="addStoreItem()">Add new item</div>
        <div class="btn btn-primary pull-right" ng-show="selectedStore" ng-click="selectedStore=null">
          Back
        </div>
      </div>

    </div>
  </div>
</div>



























<script>
  handler = Gmaps.build('Google');
  console.log(handler)
  var geocoder = new google.maps.Geocoder();

  newMarker = null

  handler.buildMap({
      provider: {
        disableDefaultUI: false,
        zoom: 10
        // pass in other Google Maps API options here
      },
      internal: {
        id: 'map'
      }
    },
    function(){
      markers = handler.addMarkers(<%=raw @hash.to_json %>);
      if(navigator.geolocation)
        navigator.geolocation.getCurrentPosition(displayOnMap);
      google.maps.event.addListener(handler.getMap(), 'click', function(event) {
        console.log(event.latLng.lat());
        lat = event.latLng.lat()
        lng = event.latLng.lng()
        console.log(event);
        $('#mLat').val(lat)
        $('#mLgn').val(lng)
        geocoder.geocode({
          'latLng': event.latLng
        }, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            if (results[0]) {
              $('#locationName').val(results[0].formatted_address);
            }
          }
        });
      });
    }
  );


  function displayOnMap(position){
    var marker = handler.addMarker({
      lat: position.coords.latitude,
      lng: position.coords.longitude
    });
    handler.map.centerOn(marker);
  };

  // google.maps.event.addListener("#map", 'click', function( event ){
  //   alert( "Latitude: "+event.latLng.lat()+" "+", longitude: "+event.latLng.lng() ); 
  // });


</script>

